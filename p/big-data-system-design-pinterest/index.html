<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="How to Design the Image Recommendation Engine for Pinterest Intro We&rsquo;re tasked with designing a scalable image recommendation system for Pinterest. It leverages the latest in big data and machine learning technologies, such as Kafka, Flink, Spark, Hadoop, Iceberg, Airflow, and Presto. Assumptions for the Technical Workflow: Pinterest&rsquo;s platform gathers millions of user interactions every day, including image views, saves, comments, and likes. The image recommendation engine must adapt quickly to a user&rsquo;s changing interests and provide real-time, personalized content."><title>Big Data System Design Pinterest</title>
<link rel=canonical href=https://blog.xiax.xyz/p/big-data-system-design-pinterest/><link rel=stylesheet href=/scss/style.min.3eb3ec85c4678737b7eff912dd406e23d3999d96facbe09744dc8f1364656d34.css><meta property='og:title' content="Big Data System Design Pinterest"><meta property='og:description' content="How to Design the Image Recommendation Engine for Pinterest Intro We&rsquo;re tasked with designing a scalable image recommendation system for Pinterest. It leverages the latest in big data and machine learning technologies, such as Kafka, Flink, Spark, Hadoop, Iceberg, Airflow, and Presto. Assumptions for the Technical Workflow: Pinterest&rsquo;s platform gathers millions of user interactions every day, including image views, saves, comments, and likes. The image recommendation engine must adapt quickly to a user&rsquo;s changing interests and provide real-time, personalized content."><meta property='og:url' content='https://blog.xiax.xyz/p/big-data-system-design-pinterest/'><meta property='og:site_name' content='A Cat Entertainer'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='pinterest'><meta property='article:tag' content='big data'><meta property='article:tag' content='technical interview'><meta property='article:tag' content='system design'><meta property='article:tag' content='kafka'><meta property='article:tag' content='flink'><meta property='article:tag' content='iceberg'><meta property='article:tag' content='hadoop'><meta property='article:tag' content='presto'><meta property='article:tag' content='airflow'><meta property='article:published_time' content='2024-03-25T06:23:23-07:00'><meta property='article:modified_time' content='2024-03-25T06:23:23-07:00'><meta property='og:image' content='https://blog.xiax.xyz/p/big-data-system-design-pinterest/Pinterest-2-1024x500.png'><meta name=twitter:title content="Big Data System Design Pinterest"><meta name=twitter:description content="How to Design the Image Recommendation Engine for Pinterest Intro We&rsquo;re tasked with designing a scalable image recommendation system for Pinterest. It leverages the latest in big data and machine learning technologies, such as Kafka, Flink, Spark, Hadoop, Iceberg, Airflow, and Presto. Assumptions for the Technical Workflow: Pinterest&rsquo;s platform gathers millions of user interactions every day, including image views, saves, comments, and likes. The image recommendation engine must adapt quickly to a user&rsquo;s changing interests and provide real-time, personalized content."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://blog.xiax.xyz/p/big-data-system-design-pinterest/Pinterest-2-1024x500.png'><link rel="shortcut icon" href=/favicon.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-DBH469RMWM"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DBH469RMWM",{anonymize_ip:!1})}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu24609b204ce41225aec778067808461c_22211_300x0_resize_q75_box.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ±</span></figure><div class=site-meta><h1 class=site-name><a href=/>A Cat Entertainer</a></h1><h2 class=site-description>Engineer | Cat Entertainer | Photographer | Gamer</h2></div></header><ol class=social-menu><li><a href target=_blank rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg></a></li><li><a href=https://github.com/xingfanxia target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://lightroom.adobe.com/u/xingfanxia target=_blank title=lightroom rel=me><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-camera"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 7h1a2 2 0 002-2 1 1 0 011-1h6a1 1 0 011 1 2 2 0 002 2h1a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9a2 2 0 012-2"/><path d="M9 13a3 3 0 106 0 3 3 0 00-6 0"/></svg></a></li><li><a href=https://www.linkedin.com/in/xingfanxia/ target=_blank title=linkedin rel=me><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://xiax.xyz target=_blank title=mysite rel=me><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-palette"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 21a9 9 0 010-18c4.97.0 9 3.582 9 8 0 1.06-.474 2.078-1.318 2.828S17.693 15 16.5 15H14a2 2 0 00-1 3.75A1.3 1.3.0 0112 21"/><path d="M8.5 10.5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12.5 7.5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M16.5 10.5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/apps><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-box"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3l8 4.5v9L12 21l-8-4.5v-9L12 3"/><path d="M12 12l8-4.5"/><path d="M12 12v9"/><path d="M12 12 4 7.5"/></svg>
<span>Apps</span></a></li><li><a href=/projects><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-code"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 8l-4 4 4 4"/><path d="M17 8l4 4-4 4"/><path d="M14 4l-4 16"/></svg>
<span>Projects</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#assumptions-for-the-technical-workflow>Assumptions for the Technical Workflow:</a></li><li><a href=#overall-architecture-design>Overall Architecture Design</a><ol><li><a href=#technical-workflow>Technical Workflow:</a></li><li><a href=#1-data-ingestion-apache-kafka>1. Data Ingestion (Apache Kafka):</a></li><li><a href=#2-real-time-stream-processing-apache-flink>2. Real-time Stream Processing (Apache Flink):</a></li><li><a href=#3-batch-processing-and-analysis-apache-spark>3. Batch Processing and Analysis (Apache Spark):</a></li><li><a href=#4-workflow-orchestration-apache-airflow>4. Workflow Orchestration (Apache Airflow):</a></li><li><a href=#5-data-storage-hadoop--apache-iceberg>5. Data Storage (Hadoop + Apache Iceberg):</a></li><li><a href=#6-interactive-querying-presto>6. Interactive Querying (Presto):</a></li><li><a href=#7-data-lifecycle-and-schema-management>7. Data Lifecycle and Schema Management:</a></li><li><a href=#8-advanced-machine-learning-and-analytics-spark--mllib>8. Advanced Machine Learning and Analytics (Spark + MLlib):</a></li><li><a href=#9-monitoring-and-governance>9. Monitoring and Governance:</a></li></ol></li><li><a href=#technical-detail-followups>Technical Detail Followups</a><ol><li><a href=#kafka>Kafka</a></li><li><a href=#flink>Flink</a></li><li><a href=#spark>Spark</a></li><li><a href=#airflow>Airflow</a></li><li><a href=#hadoop--iceberg>Hadoop & Iceberg</a></li><li><a href=#presto>Presto</a></li><li><a href=#data-lifecycle-and-schema-management>Data Lifecycle and Schema Management</a></li><li><a href=#advanced-machine-learning-and-analytics>Advanced Machine Learning and Analytics</a></li><li><a href=#monitoring-and-governance>Monitoring and Governance</a></li></ol></li><li><a href=#design-choice-follow-ups>Design Choice Follow ups</a><ol><li><a href=#kafka-1>Kafka</a></li><li><a href=#flink-1>Flink</a></li><li><a href=#spark-1>Spark</a></li><li><a href=#airflow-1>Airflow</a></li><li><a href=#hadoop--iceberg-1>Hadoop & Iceberg</a></li><li><a href=#presto-1>Presto</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/big-data-system-design-pinterest/><img src=/p/big-data-system-design-pinterest/Pinterest-2-1024x500_huc282f49b8f48afaa5f37eb45efe62148_460836_800x0_resize_box_3.png srcset="/p/big-data-system-design-pinterest/Pinterest-2-1024x500_huc282f49b8f48afaa5f37eb45efe62148_460836_800x0_resize_box_3.png 800w, /p/big-data-system-design-pinterest/Pinterest-2-1024x500_huc282f49b8f48afaa5f37eb45efe62148_460836_1600x0_resize_box_3.png 1600w" width=800 height=391 loading=lazy alt="Featured image of post Big Data System Design Pinterest"></a></div><div class=article-details><header class=article-category><a href=/categories/technical-interview/>Technical Interview
</a><a href=/categories/system-design/>System Design
</a><a href=/categories/big-data/>Big Data</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/big-data-system-design-pinterest/>Big Data System Design Pinterest</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 25, 2024</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>12 minute read</time></div></footer></div></header><section class=article-content><h1 id=how-to-design-the-image-recommendation-engine-for-pinterest>How to Design the Image Recommendation Engine for Pinterest</h1><h1 id=intro>Intro</h1><p>We&rsquo;re tasked with designing a scalable image recommendation system for Pinterest. It leverages the latest in big data and machine learning technologies, such as Kafka, Flink, Spark, Hadoop, Iceberg, Airflow, and Presto.</p><h2 id=assumptions-for-the-technical-workflow>Assumptions for the Technical Workflow:</h2><ul><li>Pinterest&rsquo;s platform gathers millions of user interactions every day, including image views, saves, comments, and likes.</li><li>The image recommendation engine must adapt quickly to a user&rsquo;s changing interests and provide real-time, personalized content.</li></ul><h2 id=overall-architecture-design>Overall Architecture Design</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>User</span> <span class=n>Apps</span> <span class=o>&amp;</span> <span class=n>Web</span> <span class=n>Browsers</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|</span> <span class=n>Publish</span> <span class=n>user</span> <span class=n>interactions</span> <span class=p>(</span><span class=n>clicks</span><span class=p>,</span> <span class=n>views</span><span class=p>,</span> <span class=n>etc</span><span class=o>.</span><span class=p>)</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=n>v</span>
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>Kafka</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|</span> <span class=n>User</span> <span class=n>interactions</span> <span class=n>stream</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=n>v</span>
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>Flink</span> <span class=o>--------------&gt;</span> <span class=n>Perform</span> <span class=n>real</span><span class=o>-</span><span class=n>time</span> <span class=n>processing</span><span class=p>,</span> <span class=n>update</span> <span class=n>recommendation</span> <span class=n>models</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|</span> <span class=n>Write</span> <span class=n>Flink</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=n>v</span>
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>Hadoop</span> <span class=o>&lt;---&gt;</span> <span class=n>Iceberg</span>  <span class=o>&lt;-------------</span> <span class=n>Airflow</span> <span class=n>coordinating</span> <span class=n>batch</span> <span class=n>jobs</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|</span>Â Â Â Â Â Â Â Â <span class=o>|</span> <span class=n>Tables</span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â    <span class=o>|</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|</span>Â Â Â Â Â Â Â Â <span class=o>|</span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â   <span class=o>|</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|&lt;--</span> <span class=n>Batch</span> <span class=n>Processing</span> <span class=o>&amp;</span> <span class=n>ETL</span> <span class=n>via</span> <span class=n>Spark</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|</span> <span class=n>SQL</span> <span class=n>queries</span> <span class=k>for</span> <span class=n>deep</span> <span class=n>analytics</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=n>v</span>
</span></span><span class=line><span class=cl>   <span class=n>Presto</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=o>|</span> <span class=n>Visualization</span> <span class=o>&amp;</span> <span class=n>Data</span> <span class=n>Exploration</span>
</span></span><span class=line><span class=cl>Â Â Â Â  <span class=n>v</span>
</span></span><span class=line><span class=cl><span class=n>Business</span> <span class=n>Analysts</span> <span class=o>&amp;</span> <span class=n>Data</span> <span class=n>Scientists</span>
</span></span></code></pre></td></tr></table></div></div><pre class=mermaid>graph TB
Â Â Â Â UA[User Apps & Web Browsers] -->|Publish user interactions| K[Kafka]
Â Â Â Â K -->|User interactions stream| F[Flink]
Â Â Â Â F -->|Real-time processing| OS[Recommendation System]
Â Â Â Â F -->|Write real-time results| H[Hadoop]
Â Â Â Â 
Â Â Â Â SP[Spark for Batch Analysis & Machine Learning] --> H
Â Â Â Â A[Airflow] -->|Schedule & orchestrate| SP
Â Â Â Â 
Â Â Â Â H -->|Data stored in| I[Iceberg Tables]
Â Â Â Â 
Â Â Â Â P[Presto] -->|SQL analytics queries| I
Â Â Â Â 
Â Â Â Â B[Business Analysts & Data Scientists] -->|Visualization & Data Exploration| P
Â Â Â Â 
Â Â Â Â %% Increase fontsize for all nodes
Â Â Â Â classDef default fontsize:20px, color:#000, fill:#fff, stroke:#000;
</pre><h3 id=technical-workflow>Technical Workflow:</h3><h3 id=1-data-ingestion-apache-kafka>1. Data Ingestion (Apache Kafka):</h3><ul><li><strong>Kafka Producers</strong>: Embed in the Pinterest app and web client. They serialize user activities into compact JSON or Avro formats and send events to <code>user-interactions</code> topics, partitioned principally by user ID for efficient stream processing.</li><li><strong>Kafka Brokers</strong>: Set up with topic partitions for redundancy and parallelism, and to ensure high availability and durability of the user interaction events. The partitioning allows for horizontal scalability in the face of increasing data volumes.</li></ul><h3 id=2-real-time-stream-processing-apache-flink>2. Real-time Stream Processing (Apache Flink):</h3><ul><li><strong>Streaming Jobs in Flink</strong>: These jobs use Flink&rsquo;s rich CEP (Complex Event Processing) library to identify patterns of user interactions. They might capture sequences like frequent views of a particular image category, which triggers an immediate update to the user&rsquo;s real-time recommendation profile.</li><li><strong>Real-time Recommendation Model Updates</strong>: Take advantage of Flink&rsquo;s state management to quickly adjust recommendation models. These models are stored in state backends, with Flink ensuring fault tolerance using its snapshot and checkpoint mechanisms.</li></ul><h3 id=3-batch-processing-and-analysis-apache-spark>3. Batch Processing and Analysis (Apache Spark):</h3><ul><li><strong>Feature Extraction and Machine Learning</strong>: Utilize Spark MLlib to periodically train collaborative filtering, clustering, and deep learning models. These models consume significant amounts of image metadata, user demographic information, and historical interaction logs to improve recommendation accuracy.</li><li><strong>Data Preprocessing and ETL Jobs</strong>: Regularly extract, transform, and load fresh data from HDFS into the format required by machine learning models, performed by Spark&rsquo;s SQL and Dataframe/Dataset APIs.</li></ul><h3 id=4-workflow-orchestration-apache-airflow>4. Workflow Orchestration (Apache Airflow):</h3><ul><li><strong>Machine Learning Pipeline Coordination</strong>: Use Airflow to manage dependencies among batch jobs, which includes pre-processing data, re-training recommendation models, and updating the production model serving layer.</li><li><strong>Data Pipeline Monitoring</strong>: Allows for monitoring and scheduling of regular ETL jobs and ensures that model training occurs on an updated dataset.</li></ul><h3 id=5-data-storage-hadoop--apache-iceberg>5. Data Storage (Hadoop + Apache Iceberg):</h3><ul><li><strong>Raw Data Storage in HDFS</strong>: Acts as the central repository store for raw event data, user profiles, and image metadata. Optimized for sequential access patterns and leverages Hadoop&rsquo;s robust data replication for fault tolerance.</li><li><strong>Curated Data Layers with Iceberg</strong>: Iceberg tables store derived views, aggregated metrics, and machine learning features, optimizing the most common access patterns and providing ACID transactions to keep analytical data consistent even during updates.</li></ul><h3 id=6-interactive-querying-presto>6. Interactive Querying (Presto):</h3><ul><li><strong>Ad-Hoc Queries and Analysis</strong>: Presto allows data scientists to quickly explore datasets and run ad-hoc analytical queries which help in identifying new trends. They can perform joins across various Iceberg tables containing user interactions, image features, and models&rsquo; output scores.</li></ul><h3 id=7-data-lifecycle-and-schema-management>7. Data Lifecycle and Schema Management:</h3><ul><li><strong>Data Retention Policies</strong>: Implemented within Kafka and HDFS to manage and age data, ensuring storage costs are optimized without compromising the ability to retrain historical models.</li><li><strong>Schema Evolution in Iceberg</strong>: Provides flexibility in evolving metadata structures and data schema as the formats of user interactions and image representations change over time.</li></ul><h3 id=8-advanced-machine-learning-and-analytics-spark--mllib>8. Advanced Machine Learning and Analytics (Spark + MLlib):</h3><ul><li><strong>Model Training and Evaluation</strong>: Utilizes large-scale, distributed processing capabilities of Spark to handle the computationally intensive task of machine learning model training, feature engineering, and historical data analysis.</li></ul><h3 id=9-monitoring-and-governance>9. Monitoring and Governance:</h3><ul><li><strong>Comprehensive Monitoring</strong>: Collects metrics and logs from Kafka, Flink, Spark, and Presto jobs using tools like Prometheus and ELK Stack. These metrics are vital for identifying processing bottlenecks and ensuring the reliability of the data pipelines.</li><li><strong>Data Governance and Compliance</strong>: Implemented across all data stores, with policies enforced to maintain data privacy, access controls, audit logging, and lineage tracking through tools like Apache Atlas and Ranger.</li></ul><h2 id=technical-detail-followups>Technical Detail Followups</h2><h3 id=kafka>Kafka</h3><ul><li><strong>Q:</strong>
How does the Kafka architecture handle failures and ensure message durability?<ul><li><p><strong>A:</strong></p><p>Kafka uses a distributed commit log, where messages are appended and replicated across multiple brokers. Durability is ensured through these replications; if one broker fails, the others can provide the data. Kafka also uses a write-ahead log to disk, so messages are not lost in case of a system crash. A combination of in-sync replicas and acknowledgments from producers upon writes further fortifies the reliability of the message delivery.</p></li></ul></li></ul><h3 id=flink>Flink</h3><ul><li><strong>Q:</strong>
Can you expand on how Flink&rsquo;s state management supports the real-time image recommendation feature?<ul><li><p><strong>A:</strong></p><p>Flink&rsquo;s state management allows for the retention of relevant context during processing. For example, it can keep track of the current state of a user&rsquo;s interaction pattern or a model&rsquo;s parameters. This state is consistently checkpointed and stored in a persistent storage like HDFS or Amazon S3, so if there&rsquo;s a failure, the application can resume from the latest successful checkpoint, minimizing data loss and computation.</p></li></ul></li></ul><h3 id=spark>Spark</h3><ul><li><strong>Q:</strong>
How does Spark handle the iterative computation required for machine learning algorithms used in image recommendations?<ul><li><p><strong>A:</strong></p><p>Spark&rsquo;s core abstraction, the Resilient Distributed Dataset (RDD), is well suited for iterative algorithms common in machine learning. This is because once an RDD is loaded into memory, it&rsquo;s kept there for as long as necessary, drastically speeding up iterative data passes essential for algorithms like gradient descent. Spark&rsquo;s MLlib also optimizes algorithms for distributed computing, partitioning the data across nodes to parallelize computations.</p></li></ul></li></ul><h3 id=airflow>Airflow</h3><ul><li><strong>Q:</strong>
How does Apache Airflow help managing dependencies in the ETL workflows for the recommendation engine?<ul><li><p><strong>A:</strong></p><p>In Airflow, workflows are expressed as DAGs, with each node representing a task and the edges representing dependencies between these tasks. Airflow can manage scheduling and running these tasks based on the specified dependencies, and it supports complex workflows where the execution order of tasks is critical. It also retries failed tasks, sends alerts, and can dynamically adjust workflows based on parameters or external triggers.</p></li></ul></li></ul><h3 id=hadoop--iceberg>Hadoop & Iceberg</h3><ul><li><strong>Q:</strong>
Describe how Hadoop and Apache Iceberg work together to manage the large datasets in this application.<ul><li><p><strong>A:</strong></p><p>Hadoop provides the distributed storage (HDFS) and computing resources (YARN) needed to manage and process large-scale datasets, while Apache Iceberg integrates with HDFS to manage these datasets as structured tables. Iceberg adds layers like snapshotting, schema evolution, and transactional capabilities on top of the raw file system, which allows for efficient updates and querying of massive tables within HDFS.</p></li></ul></li></ul><h3 id=presto>Presto</h3><ul><li><strong>Q:</strong>
What specific features of Presto make it a fit for the interactive querying requirements of data scientists?<ul><li><p><strong>A:</strong></p><p>Presto&rsquo;s in-memory distributed query engine is designed for low-latency, interactive data analysis. It supports complex SQL queries, including aggregations, joins, and window functions that are essential for data scientists to explore and analyze big data quickly. Its ability to query data where it lives, without the need for data movement or transformation, streamlines analysis and reduces time to insight.</p></li></ul></li></ul><h3 id=data-lifecycle-and-schema-management>Data Lifecycle and Schema Management</h3><ul><li><strong>Q:</strong>
Can you delve into the specifics of how schema evolution is handled in a pipeline with mixed batch and real-time components?<ul><li><p><strong>A:</strong></p><p>Schema evolution must be managed carefully to ensure compatibility across different data models used by batch and real-time systems. Iceberg helps manage this by allowing schema changes to occur without downtime or requiring a rewrite of data. It maintains a history of schemas and supports schema enforcement and evolution with backward and forward compatibility. Data produced by real-time Flink jobs can evolve, and batch-based Spark jobs can accommodate these changes, as both can interact with the updated schema without interrupt to ongoing operations.</p></li></ul></li></ul><h3 id=advanced-machine-learning-and-analytics>Advanced Machine Learning and Analytics</h3><ul><li><strong>Q:</strong>
Explain the process of feature engineering for images in Spark and how it contributes to recommendation quality.<ul><li><p><strong>A:</strong></p><p>Feature engineering in Spark for images involves extracting meaningful information from raw image data that can be used to train recommendation models. Using Spark&rsquo;s MLlib, we could perform tasks like resizing images, normalizing pixel values, and extracting color histograms or texture patterns. MLlib can also be used to apply more sophisticated techniques like deep learning to extract higher-level features. These engineered features are critical for training effective recommendation models that can distinguish between different types of images and user preferences.</p></li></ul></li></ul><h3 id=monitoring-and-governance>Monitoring and Governance</h3><ul><li><strong>Q:</strong>
How does the monitoring infrastructure support the operational stability of the image recommendation service?<ul><li><p><strong>A:</strong></p><p>The monitoring infrastructure collects metrics and logs from all components of the pipeline. With tools like Prometheus, we can track system performance metrics in real time and set up alerts to notify if certain thresholds are exceeded. The ELK Stack is used for log analysis, which helps in diagnosing system problems and understanding user behavior. Together, they ensure the operational stability of the service by allowing us to rapidly identify and address issues as they arise, ensuring a smooth user experience.</p></li></ul></li></ul><h2 id=design-choice-follow-ups>Design Choice Follow ups</h2><p>Here are more detailed Q&amp;A examples focusing on the context of a real-world Pinterest-like image recommendation system, weighing the pros and cons of utilized technologies, and discussing alternatives:</p><h3 id=kafka-1>Kafka</h3><ul><li><strong>Q:</strong>
Why choose Kafka over other messaging systems for real-time user interaction data ingestion?<ul><li><p><strong>A:</strong></p><p>Kafka is highly scalable and durable, making it ideal for handling the high-volume and high-velocity data streams produced by Pinterest&rsquo;s user interaction events. Its distributed nature and partitioned topics provide fault tolerance and low-latency, which are crucial for real-time recommendation systems.</p></li><li><p><strong>Cons:</strong></p><p>Kafka can be complex to set up and operate, particularly regarding cluster management and monitoring.</p></li><li><p><strong>Alternatives:</strong></p><p>Apache Pulsar is an alternative that can offer similar scalability and durability, with native support for multi-tenancy and geo-replication, which could be beneficial for a global platform like Pinterest.</p></li></ul></li></ul><h3 id=flink-1>Flink</h3><ul><li><strong>Q:</strong>
What makes Flink the preferred choice for real-time recommendation updates and not other stream processing frameworks?<ul><li><p><strong>A:</strong></p><p>Flink&rsquo;s ability to handle complex event processing and maintain rich state management is unmatched. This enables more sophisticated real-time recommendation model updates and user interaction pattern analysis.</p></li><li><p><strong>Cons:</strong></p><p>Flink&rsquo;s complex event processing capabilities might be overkill for simpler interaction patterns or where latency is less of a concern.</p></li><li><p><strong>Alternatives:</strong></p><p>Apache Storm is a simpler alternative for stream processing that can be considered if the processing needs are less complex. For tightly integrated Kafka environments, Kafka Streams might suffice for lightweight, real-time processing tasks.</p></li></ul></li></ul><h3 id=spark-1>Spark</h3><ul><li><strong>Q:</strong>
In the context of feature extraction and machine learning for image recommendations, what are Spark&rsquo;s advantages and disadvantages?<ul><li><p><strong>A:</strong></p><p>Spark&rsquo;s MLlib for machine learning and its overall ecosystem for big data processing makes it versatile for handling the ETL, feature extraction, and model training workloads. It is efficient at iterative computation, which is essential in training machine learning models.</p></li><li><p><strong>Cons:</strong></p><p>Spark&rsquo;s in-memory processing model can be expensive, especially when dealing with very large datasets, as it requires a large amount of RAM.</p></li><li><p><strong>Alternatives:</strong></p><p>Hadoop MapReduce can be a more cost-effective batch processing alternative in environments that are not latency-sensitive. For deep learning specific tasks, frameworks like TensorFlow or PyTorch could be integrated for GPU-accelerated processing.</p></li></ul></li></ul><h3 id=airflow-1>Airflow</h3><ul><li><strong>Q:</strong>
What features does Airflow offer over other workflow management tools?<ul><li><p><strong>A:</strong></p><p>Airflow provides an expressive framework for defining complex dependencies and schedules in data processing pipelines. Its user-friendly UI and extensive monitoring capabilities make managing workflows much more straightforward.</p></li><li><p><strong>Cons:</strong></p><p>Airflow can be resource-intensive and has a steeper learning curve, particularly for those unfamiliar with Python.</p></li><li><p><strong>Alternatives:</strong></p><p>Luigi is a simpler Python-based workflow engine that might be appropriate for smaller-scale or less complex workflows. Apache NiFi offers a more GUI-driven approach for data flow management and could be preferable for teams looking for less code-intensive solutions.</p></li></ul></li></ul><h3 id=hadoop--iceberg-1>Hadoop & Iceberg</h3><ul><li><strong>Q:</strong>
Are there any drawbacks to using Hadoop and Iceberg, and what other systems could be used?<ul><li><p><strong>A:</strong></p><p>Hadoop&rsquo;s HDFS is proven, reliable, and integrates well with big data processing tools. However, it might not be as cost-effective for storage compared to cloud object stores and is complex to manage. Iceberg provides excellent table management features, but is relatively new and has less community support compared to more mature tools.</p></li><li><p><strong>Cons:</strong></p><p>Hadoop cluster requires significant setup and maintenance efforts. Iceberg is not as battle-tested as other formats and may still be evolving.</p></li><li><p><strong>Alternatives:</strong></p><p>Cloud-based storage options like Amazon S3 or Azure Data Lake Storage offer similar scalability with lower operational overhead. Delta Lake is an alternative to Iceberg that provides similar ACID guarantees and seamless integration with Databricksâ€™ platform.</p></li></ul></li></ul><h3 id=presto-1>Presto</h3><ul><li><strong>Q:</strong>
Presto is used for interactive querying, but what factors should we consider when choosing it, and are there any competitive technologies?<ul><li><p><strong>A:</strong></p><p>Presto&rsquo;s distributed architecture allows for fast query execution over large datasets, which is critical for data exploration and timely insights. However, for very large-scale data warehousing tasks and complex query workloads, Presto may not perform as well as dedicated solutions.</p></li><li><p><strong>Cons:</strong></p><p>Presto may not handle long-running analytical queries as effectively due to its design for ad-hoc querying. Also, it could be less cost-effective for persistent workloads.</p></li><li><p><strong>Alternatives:</strong></p><p>Apache Drill supports similar SQL queries on large-scale data but can be more forgiving on resource demands. Amazon Athena and Google BigQuery offer serverless querying options for those already invested in the respective cloud ecosystems.</p></li></ul></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/pinterest/>Pinterest</a>
<a href=/tags/big-data/>Big Data</a>
<a href=/tags/technical-interview/>Technical Interview</a>
<a href=/tags/system-design/>System Design</a>
<a href=/tags/kafka/>Kafka</a>
<a href=/tags/flink/>Flink</a>
<a href=/tags/iceberg/>Iceberg</a>
<a href=/tags/hadoop/>Hadoop</a>
<a href=/tags/presto/>Presto</a>
<a href=/tags/airflow/>Airflow</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/big-data-system-design-uber-eats/><div class=article-image><img src=/p/big-data-system-design-uber-eats/Uber_Eats_Logo.5d43ff7985f3c474a2202fe0b3ce6fb8_hu9919f7b3f46635b6673d32d5992520f9_38864_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post Big Data System Design Uber Eats" data-hash="md5-XUP/eYXzxHSiIC/gs85vuA=="></div><div class=article-details><h2 class=article-title>Big Data System Design Uber Eats</h2></div></a></article><article class=has-image><a href=/p/system-design-interview-framework/><div class=article-image><img src=/p/system-design-interview-framework/banner.ea6d1516d5dd0f51df24f45918be64b9_hu6bdf848fc2e03cb76a7cc594088d1a18_89181_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post System Design Interview Framework" data-hash="md5-6m0VFtXdD1HfJPRZGL5kuQ=="></div><div class=article-details><h2 class=article-title>System Design Interview Framework</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=xingfanxia/blog.xiax.xyz data-repo-id=R_kgDOLkaUkg data-category=Announcements data-category-id=DIC_kwDOLkaUks4CeNSA data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2024 A Cat Entertainer</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.24.2>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script></html>